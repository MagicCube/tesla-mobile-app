var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,n=(e,n)=>{for(var r in n||(n={}))i.call(n,r)&&o(e,r,n[r]);if(t)for(var r of t(n))s.call(n,r)&&o(e,r,n[r]);return e},r=(e,t,i)=>(o(e,"symbol"!=typeof t?t+"":t,i),i);import{j as a,u as l,r as c,c as h,L as d,V as p,E as u,W as m,S as _,P as f,O as g,T as b,a as y,A as v,D as w,b as x,d as P,e as C,f as k,G as z,g as E,R as O,C as N,h as L,i as j,k as A,l as I,B as M}from"./vendor.4f52360a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var T={container:"_container_gnk64_1",wrapper:"_wrapper_gnk64_7",icon:"_icon_gnk64_13"};const B=a.exports.jsx,S=a.exports.jsxs,R=a.exports.Fragment,D=({className:e,title:t,showBackButton:i})=>{const s=l(),o=c.exports.useCallback((()=>{i&&s.goBack()}),[s,i]);return B("div",{className:h(T.container,e),children:S("div",{className:T.wrapper,onClick:o,children:[i?B("div",{className:T.backButton,children:B("i",{className:h(T.icon,"iconfont","icon-backarrow")})}):null,B("h2",{className:T.title,children:t})]})})};var V=[{path:"controls",title:"Controls",desc:"控制车门，车窗及前后背箱等",icon:"window",scenePlay:{view:"default"}},{path:"climate",title:"Climate",desc:"调节车内温度，控制座椅加热等",icon:"fan",scenePlay:{view:"climate"}},{path:"appearance",title:"Appearance",desc:"多角度检视车身的外观",icon:"vehicle",scenePlay:{view:"default"}},{path:"interior",title:"Interior",desc:"进入车舱内部，查看内饰",icon:"driving-wheel",scenePlay:{view:"interior"}}];var $={container:"_container_6dhvr_1",list:"_list_6dhvr_6",link:"_link_6dhvr_21",icon:"_icon_6dhvr_29",info:"_info_6dhvr_34",title:"_title_6dhvr_38",about:"_about_6dhvr_41"};const H=()=>S("div",{className:$.about,children:[B("h3",{children:"About this app"}),S("div",{children:[S("p",{children:["This application is powered by"," ",B("a",{href:"https://threejs.org/",target:"_blank",rel:"noreferrer",children:"Three.js"})," ","and"," ",B("a",{href:"https://reactjs.org/",target:"_blank",rel:"noreferrer",children:"React"}),"."," "]}),S("p",{children:["You can find the source code on"," ",B("a",{href:"https://github.com/magiccube/tesla-mobile-app",target:"_blank",rel:"noreferrer",children:"Github"}),"."]}),S("p",{children:["© 2021"," ",B("a",{href:"https://github.com/magiccube",target:"_blank",rel:"noreferrer",children:"Henry Li"}),"."]}),B("p",{children:"“TESLA” and “MODEL 3” are the trademarks of TESLA, Inc."}),S("p",{children:["The 3D model is provided by"," ",B("a",{href:"https://sketchfab.com/uchiha.321abc",target:"_blank",rel:"noreferrer",children:"Ameer Studio"})," ","under"," ",B("a",{href:"http://creativecommons.org/licenses/by/4.0/",target:"_blank",rel:"noreferrer",children:"CC-BY-4.0"})," ","license."]})]})]}),K=({className:e})=>S("div",{className:h($.container,e),children:[B("ul",{className:$.list,children:V.map((e=>B("li",{children:S(d,{className:$.link,to:`/tesla-mobile-app/${e.path}`,children:[B("i",{className:h($.icon,"iconfont",`icon-${e.icon}`)}),S("div",{className:$.info,children:[B("h3",{className:$.title,children:e.title}),B("div",{className:$.desc,children:e.desc})]})]})},e.path)))}),B(H,{})]});function Y(e,t=!0){return t?Math.random()*e*2-e:Math.random()*e}function F(e){return Array.isArray(e)&&3===e.length?new p(e[0],e[1],e[2]):e}function W(e){return Array.isArray(e)&&3===e.length?{x:e[0],y:e[1],z:e[2]}:{x:e.x,y:e.y,z:e.z}}function q(e,t,i,s=0){i(e,s),s<t&&e.children.forEach((e=>{q(e,t,i,s+1)}))}class G extends u{constructor(e,t){var i;super(),r(this,"_size"),r(this,"_renderer"),r(this,"_scene"),r(this,"_camera"),r(this,"_lights",[]),r(this,"_orbitControls"),r(this,"_options"),this._options=t,this._size=t.size,this._renderer=new m({canvas:e,antialias:!0,logarithmicDepthBuffer:!0}),this._scene=new _,this._camera=new f((null==(i=t.camera)?void 0:i.fov)||75),this._camera.name="main-camera",this._orbitControls=new g(this._camera,this.canvas)}get canvas(){return this._renderer.domElement}get size(){return this._size}set size(e){this.resizeTo(e)}get renderer(){return this._renderer}get scene(){return this._scene}get camera(){return this._camera}get lights(){return this._lights}get orbitControls(){return this._orbitControls}get allowAnimation(){return true}get options(){return this._options}init(){this.resizeTo(this.size),this.setup()}play(){this.animate(0)}debug(){console.info(this.camera.position.toArray(),this._orbitControls.target.toArray())}panCamera(e,t,i=1200,s){if(this.allowAnimation&&i>0){const o=W(e),n=W(t);return new Promise((e=>{var t,r;new b(this.camera.position).to(o,i).onComplete((()=>{e()})).easing(s||(null==(t=this.options.camera)?void 0:t.easing)||y.Linear.None).start(),new b(this._orbitControls.target).to(n).easing(s||(null==(r=this.options.camera)?void 0:r.easing)||y.Linear.None).start()}))}return this.camera.position.copy(F(e)),this._orbitControls.target.copy(F(t)),Promise.resolve()}moveCamera(e,t=1200,i){return this.panCamera(e,[0,0,0],t,i)}setup(){this.setupRenderer(),this.setupCamera(),this.setupLights(),this.setupScene(),this.setupControls()}setupRenderer(){}setupCamera(){var e;const t=F((null==(e=this.options.camera)?void 0:e.position)||[0,0,1]);this._camera.position.copy(t)}setupLights(){const e=new v(16777215,.2);e.name="ambient-light",this._scene.add(e),this._lights.push(e);const t=new w(16777215,.75);t.name="main-light",t.position.set(0,1,0),t.castShadow=!0,this._scene.add(t),this._lights.push(t),[[0,300,500],[500,100,0],[0,100,-500],[-500,300,500]].forEach(((e,t)=>{const i=new x(12895428,.5);i.name=`point-light-${t+1}`,i.position.set(...e),this._scene.add(i),this._lights.push(i)}))}setupScene(){}setupControls(){var e;this._orbitControls.enableDamping=!0;const t=F((null==(e=this.options.camera)?void 0:e.target)||[0,0,0]);this._orbitControls.target.copy(t)}animate(e){window.requestAnimationFrame((e=>{this.animate(e)})),this.update(e)}update(e){P(e),this._orbitControls.update(),this._renderer.render(this.scene,this.camera)}resizeTo(e){this._size=e,this._renderer.setSize(this._size.width,this._size.height),this._camera.aspect=this._size.width/this._size.height,this._camera.updateProjectionMatrix()}}const X={bonnet_ok_primary_0:{isOpen:!1,type:"rotation",axis:"x",offset:Math.PI/3},boot_dummy:{isOpen:!1,type:"rotation",axis:"x",offset:-Math.PI/6},door_lf:{isOpen:!1,type:"rotation",axis:"z",offset:-Math.PI/3},door_lr:{isOpen:!1,type:"rotation",axis:"z",offset:-Math.PI/3},door_rf:{isOpen:!1,type:"rotation",axis:"z",offset:Math.PI/3},door_rr:{isOpen:!1,type:"rotation",axis:"z",offset:Math.PI/3},door_lf_glass0_0:{isOpen:!1,type:"position",axis:"z",offset:-.2},door_lr_glass0_0:{isOpen:!1,type:"position",axis:"z",offset:-.2},door_rf_glass0_0:{isOpen:!1,type:"position",axis:"z",offset:-.2},door_rr_glass0_0:{isOpen:!1,type:"position",axis:"z",offset:-.2}},J=Object.keys(X);class Q extends C{constructor(){super(...arguments),r(this,"_root",null),r(this,"_roofVisible",!0),r(this,"_movableParts",n({},X))}get allowAnimation(){return true}get roofVisible(){return this._roofVisible}set roofVisible(e){this._roofVisible!==e&&this._setRoofVisible(e)}async load(e){const t=new k;t.onProgress=(t,i,s)=>{"function"==typeof e&&e({url:t,loaded:i,total:s})};const i=new z(t),s=(await i.loadAsync("https://feng-docs.oss-cn-hangzhou.aliyuncs.com/tesla-model-3/scene.gltf")).scene.getObjectByName("Tesla_Model_3");s&&s.scale.set(1,1,1),this._root=s,this.add(this._root)}assembly(e=6e3){if(!this._root)return Promise.resolve();let t=0;return q(this._root,4,((i,s)=>{if(0==t++)return;const o=5-s,n=U(i),r=i.userData;e>0?(new b(i.position).to(r.position,Y(e/2,!1)).delay((5*o+15*t)*(n?1.2:1)).easing(y.Cubic.InOut).start(),new b(i.rotation).to(r.rotation,Y(e/2,!1)).delay(5*o+12*t).easing(y.Cubic.InOut).start()):(i.position.set(r.position.x,r.position.y,r.position.z),i.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z))})),new Promise((t=>{setTimeout((()=>{t()}),e)}))}explode(e=6e3){if(!this._root)return Promise.resolve();let t=0;return q(this._root,4,((i,s)=>{if(0==t++)return;const o=5-s;i.userData={position:W(i.position),rotation:W(i.rotation)};const n=U(i),r={position:{x:Y(5),y:Y(10),z:n?Y(5,!1)+5:Y(5)},rotation:{x:Y(Math.PI),y:Y(Math.PI),z:Y(Math.PI)}};e>0?(new b(i.position).to(r.position,Y(e/2,!1)).delay(5*o+15*t).easing(y.Cubic.InOut).start(),new b(i.rotation).to(r.rotation,Y(e/2,!1)).delay(5*o+12*t).easing(y.Cubic.InOut).start()):(i.position.set(r.position.x,r.position.y,r.position.z),i.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z))})),new Promise((t=>{setTimeout((()=>{t()}),e)}))}togglePart(e){var t;const i=this._movableParts[e],s=null==(t=this._root)?void 0:t.getObjectByName(e);return i&&s?i.isOpen?this.closePart(e):this.openPart(e):Promise.resolve()}openPart(e){return new Promise((t=>{var i;const s=this._movableParts[e],o=null==(i=this._root)?void 0:i.getObjectByName(e);s&&o&&!s.isOpen?(s.isOpen=!0,new b(o).to({[s.type]:{[s.axis]:s.offset}},500).start().onComplete((()=>{t()}))):t()}))}closePart(e){return new Promise((t=>{var i;const s=this._movableParts[e],o=null==(i=this._root)?void 0:i.getObjectByName(e);s&&o&&s.isOpen?(s.isOpen=!1,new b(o).to({[s.type]:{[s.axis]:0}},500).start().onComplete((()=>{t()}))):t()}))}async handleClick(e){let t=e;for(;null!==t&&!J.includes(t.name);){if(!t.parent){t=null;break}t=t.parent}if(t){const e=t.name;await this.togglePart(e)}}_setRoofVisible(e){this._roofVisible=e;const t=W([0,0,this.roofVisible?0:5]);["windscreen_ok_glass0_0","glass_glass1_0","black003_black_lights0_0","whiteleather_Putih0_0","Leather_white_Seat_Leather_white0_0","Putih002_Putih0_0","Plastic_Plastic0_0","interiorlights_light_night_0","mirror_inside_mirror_inside0_0","aluminium2_aluminium20_0"].forEach((e=>{var i;const s=null==(i=this._root)?void 0:i.getObjectByName(e);s&&new b(s.position).to(t,500+500*Math.random()).delay(500*Math.random()).start()}))}}function U(e){return["bonnet_ok_primary_0","boot_primary_0","glass_glass1_0","glass_glass1_1","windscreen_ok_glass0_0"].includes(e.name)}class Z extends u{constructor(e,t,i){super(),r(this,"_pointer",new E(0,0)),r(this,"_selection",null),r(this,"_raycaster",new O),r(this,"_handlePointerDown",(e=>{this._updatePointer(e);const t=[];if(this._raycaster.setFromCamera(this._pointer,this._camera),this._raycaster.intersectObjects(this._objects,!0,t),t.length>0){this._selection=t[0].object;const e={type:"select",object:this._selection};this.dispatchEvent(e)}})),this._objects=e,this._camera=t,this._domElement=i,this.activate()}get selection(){return this._selection}activate(){this._domElement.addEventListener("pointerdown",this._handlePointerDown)}deactivate(){this._domElement.removeEventListener("pointerdown",this._handlePointerDown)}dispose(){this.deactivate()}_updatePointer(e){const t=this._domElement.getBoundingClientRect();this._pointer.x=(e.clientX-t.left)/t.width*2-1,this._pointer.y=-(e.clientY-t.top)/t.height*2+1}}var ee="#161718";const te={default:[[-5.1092359402557825,2.3585518996952866,-5.686206208293889],[0,0,0]],home:[[-2.0630454676789407,3.740821669151607,-7.351070916224511],[.07093096967317583,-3.8602772541774777,-.029166030311569762]],top:[[0,4.5,0],[0,0,0]],side:[[-8.5,0,0],[0,0,0]],climate:[[2.7578341026618327e-9,4,1.1888649873971757],[0,0,0],[-.007478408949193623,2.627048252112721,1.5015885243156035],[-.007528463439677366,-.45537866287491535,1.1317027811060794]],interior:[[-2.3262856496385274,.20924417496911427,-.03313205280069673],[0,0,0],[-.4337802580564771,.319127318081177,.09316887365871929],[-.431768843062556,.3001312274226111,-.554507176768169]]};class ie extends G{constructor(e,t){super(e,n({camera:{position:[8,8,8],easing:y.Cubic.InOut}},t)),r(this,"_model"),this._model=new Q}get model(){return this._model}async setupScene(){this.scene.background=new N(ee),this.scene.add(this.model),await this.model.load((e=>{this.dispatchEvent(n({type:"progress"},e))})),this.dispatchEvent({type:"load"})}setupControls(){super.setupControls(),this.orbitControls.autoRotateSpeed*=-1,this.orbitControls.addEventListener("start",(()=>{this.orbitControls.autoRotate=!1}));const e=new Z([this.model],this.camera,this.canvas);e.addEventListener("select",(e=>{const t=e;if(t.object){const e=t.object;this.model.handleClick(e).then((()=>{})).catch((()=>{}));const i=new p;e.getWorldPosition(i),console.info(e.name,e.position.toArray(),i.toArray(),e)}})),e.activate()}async playOpeningAnimation(){this.model.explode(0),this.model.assembly(6e3),await this.panCamera([-2.0630454676789407,3.740821669151607,-7.351070916224511],[.07093096967317583,-3.8602772541774777,-.029166030311569762],6e3)}async switchView(e,t=2e3){const i=te[e];i&&(this.orbitControls.autoRotate=!1,this.model.roofVisible="climate"!==e,await this.panCamera(i[0],i[1],t),"interior"===e&&await this.model.openPart("door_lf"),i[2]&&i[3]&&await this.panCamera(i[2],i[3]),"interior"===e&&await this.model.closePart("door_lf"))}}var se="_container_1br66_1";function oe(){return{width:window.innerWidth,height:window.innerHeight}}var ne=c.exports.forwardRef((function({className:e,opacity:t,onLoad:i,onProgress:s},o){const n=c.exports.useRef(null),r=c.exports.useRef(null),a=c.exports.useCallback((()=>{n.current&&n.current.resizeTo(oe())}),[]),l=c.exports.useCallback((e=>{var t;"d"!==e.key||!e.metaKey||e.ctrlKey||e.shiftKey||(null==(t=n.current)||t.debug(),e.preventDefault())}),[]);return c.exports.useEffect((()=>(window.addEventListener("resize",a,!0),window.addEventListener("keydown",l,!0),()=>{window.removeEventListener("resize",a,!0),window.removeEventListener("keydown",l,!0)})),[a,l]),c.exports.useEffect((()=>{if(r.current){const e=new ie(r.current,{size:oe()});e.addEventListener("load",(()=>{"function"==typeof i&&i()})),e.addEventListener("progress",(e=>{"function"==typeof s&&s(e)})),e.init(),e.play(),n.current=e}}),[i,s]),c.exports.useImperativeHandle(o,(()=>n.current)),B("canvas",{ref:r,className:h(se,e),style:{opacity:t,filter:t?`blur(${1-t}rem)`:"none"}})}));var re={fixed:"_fixed_o6enz_1",scenePlay:"_scenePlay_o6enz_2",overlay:"_overlay_o6enz_3",hidden:"_hidden_o6enz_15",scrollable:"_scrollable_o6enz_18",twinkle:"_twinkle_o6enz_1"};function ae(){const e=c.exports.useRef(null),[t,i]=c.exports.useState({percentage:0,status:"正在加载 3D 模型..."}),[s,o]=c.exports.useState(1),[n,r]=c.exports.useState(!1),a=L(),l=c.exports.useCallback((t=>{let i="home";if(!e.current)return;const s=t.split("/")[2],o=V.find((e=>e.path===s));o&&(i=o.scenePlay.view),e.current.switchView(i)}),[]),d=c.exports.useCallback((()=>{if(document.scrollingElement){let e=1-document.scrollingElement.scrollTop/window.innerHeight/.33;e>1&&(e=1),e<.1&&(e=.1),o(e)}}),[]),p=c.exports.useCallback((()=>{var t;i({percentage:100,status:"加载已完成"}),"/tesla-mobile-app/"===window.location.pathname?(null==(t=e.current)||t.playOpeningAnimation(),setTimeout((()=>{var t;r(!0),(null==(t=e.current)?void 0:t.orbitControls)&&(e.current.orbitControls.autoRotate=!0)}),4400)):(r(!0),l(window.location.pathname))}),[l]),u=c.exports.useCallback((e=>{const t=e.loaded/e.total;i({percentage:t,status:`正在加载模型 ${Math.round(100*t)}%...`})}),[]);c.exports.useEffect((()=>{document.body.style.overflowY=n?"auto":"hidden"}),[n]),c.exports.useEffect((()=>(document.addEventListener("scroll",d,!0),()=>{document.removeEventListener("scroll",d,!0)})),[d]),c.exports.useEffect((()=>{document.scrollingElement&&document.scrollingElement.scrollTo(0,0)}),[]),c.exports.useEffect((()=>{l(a.pathname)}),[a.pathname,l]);const m=t.percentage<100;return S(R,{children:[B(ne,{ref:e,className:re.scenePlay,opacity:s,onLoad:p,onProgress:u}),S(j,{children:[V.map((e=>B(A,{path:`/tesla-mobile-app/${e.path}`,children:B("div",{className:h(re.fixed),children:B(D,{title:e.title,showBackButton:!0})})},e.path))),S(A,{exact:!0,path:["/tesla-mobile-app/","/tesla-mobile-app/".replace(/\/$/,"")],children:[B("div",{className:h(re.fixed,n?void 0:re.hidden),children:B(D,{title:"Digital Twin"})}),B("div",{className:h(re.scrollable,n?void 0:re.hidden),children:B("main",{className:re.content,children:B(K,{})})})]})]}),B("div",{className:h(re.overlay,m?void 0:re.hidden),children:t.status})]})}I.exports.render(B(M,{children:B(ae,{})}),document.getElementById("react-mount-point"));
